syntax = "proto3";

package portfoliodb;

import "google/protobuf/timestamp.proto";

service PortfolioDB {
  // Transaction operations
  rpc UpdateTxs(UpdateTxsRequest) returns (UpdateTxsResponse);
}

// Enums
enum TxType {
  OTHER = 0;
  BUY = 1;
  SELL = 2;
  DIVIDEND = 3;
  INTEREST = 4;
  REINVEST = 5;
  TRANSFER_IN = 6;
  TRANSFER_OUT = 7;
}

enum InstrumentType {
  UNKNOWN_INSTRUMENT = 0; // Unspecified or unrecognized type
  STK = 1;                // Equity: Common or preferred stock
  MF = 2;                 // Mutual fund
  BOND = 3;               // Corporate or government bond
  CD = 4;                 // Certificate of deposit
  OPT = 5;                // Option (standard derivative)
  FUT = 6;                // Futures contract
  MFOPT = 7;              // Option on mutual fund
  CASH = 8;               // Cash equivalent
  MMF = 9;                // Money market fund
  IET = 10;               // Exchange-traded instrument (ETF)
  FIXED = 11;             // Fixed-income schedule (e.g., structured note)
  MISC = 12;              // Miscellaneous instrument
}

enum DerivativeType {
  OPTION = 0;
  FUTURE = 1;
}

enum PutCall {
  PUT = 0;
  CALL = 1;
}

enum OptionStyle {
  UNKNOWN = 0;
  AMERICAN = 1;
  EUROPEAN = 2;
  BERMUDAN = 3;
}

enum ErrorCode {
  OK = 0;
  UNKNOWN_ERROR = 1;
}

// Common types
message DateRange {
  google.protobuf.Timestamp start = 1;
  google.protobuf.Timestamp end = 2;
}

message Broker {
  string id = 1;
  string key = 2;
  string name = 3;
}

message Identifier {
  string id = 1;
  string namespace = 2;
  string domain = 3;
  string identifier = 4;
}

message Instrument {
  string id = 1;
  InstrumentType type = 2;
  repeated Identifier identifiers = 3;
  string listing_mic = 4;
  string currency = 5;
  optional Derivative derivative = 6;
}

message Derivative {
  Identifier underlying_id = 1;
  optional Option option = 2;
}

message Option {
  google.protobuf.Timestamp expiration_date = 1;
  PutCall put_call = 2;
  double strike_price = 3;
  double mult = 4;
  OptionStyle style = 5;
}

message Tx {
  string id = 1;
  string account_id = 2;
  Identifier identifier = 3;
  double units = 4;
  optional double unit_price = 5;
  string currency = 6;
  google.protobuf.Timestamp trade_date = 7;
  optional google.protobuf.Timestamp settled_date = 8;
  TxType tx_type = 9;
}

message Error {
  ErrorCode code = 1;
  string message = 2;
} 

// Request/Response types
message UpdateTxsRequest {
  // Date range for the update
  DateRange period = 1;
  Broker broker = 2;
  repeated Instrument instruments = 3;
  repeated Tx txs = 4;
}

message UpdateTxsResponse {
  Error error = 1;
}
